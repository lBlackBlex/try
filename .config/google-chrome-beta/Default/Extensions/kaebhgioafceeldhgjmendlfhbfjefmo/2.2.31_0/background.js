var EG=null;function AL(){this.url="";this.content="";}function Aa(){this.combine="";this.content="";}function S(){this.useragent="";this.reffer="";this.cookie="";this.contentType="";this.disposition="";this.postData="";this.host="";this.contentLength="";this.url="";this.header=null;this.fileName="";this.Z="";this.segs=null;}(function(){EG_core={I:null,plugin:null,W:[],D:true,G:true,V:false,j:[],U:[],AA:false,AK:".exe;.zip;.rar;.tar;.gz;.mp3;.mp4;.3gp;.rm;.rmvb;.mpeg;.mpg;.wav;.pdf;.chm;.iso;.msi;.7z;.aac;.ape;.flac;.mkv;.mov;.ogg;.torrent;.apk;.pptx;",w:["video/x-flv","video/flv","video/mp4","video/x-mp4","video/mpeg","video/f4v","application/octet-stream","video/x-matroska","video/x-webm","audio/x-webm","audio/mp4","video/quicktime","video/x-ms-wmv","audio/webm","video/webm","video/f4f","audio/mpeg","application/vnd.apple.mpegurl","application/x-mpegURL","vnd.apple.mpegURL"],AJ:["swf","mp3","wma","wmv","mpg","wav","flv","f4v","3gp","mp4","rm","rmvb","mpeg","webm","hlv","mkv"],C:{},AH:["main_frame","sub_frame","object","xmlhttprequest","other","media"],T:[],J:{},N:0,AF:true,q:function(type){Ab=type.toLowerCase();for(var i in EG_core.AH){if(Ab==EG_core.AH[i]){return true;}}return false;},k:function(tabid){if(tabid in this.C){return this.C[tabid];}return null;},Ak:function(){return this.G;},Ae:function(browser){var agent=window.navigator.userAgent;var begin=agent.indexOf(browser);var version=0;if(begin!=-1){begin+=7;var end=agent.indexOf(" ",begin);if(end>begin){var ver_number=agent.substr(begin,end-begin);version=parseInt(ver_number.split(".")[0]);}}return version;},b:function(){return this.D;},Ai:function(){if(!EG_core.AA){EG_core.L(2);EG_core.I=null;}},Q:function(msg,create_new,exit){if(this.I==null&&create_new){this.AZ();}if(this.I==null){return false;}try{this.I.postMessage(msg);}catch(exc){console.log("postMessage exceptions");return false;}if(exit&&this.I!=null){this.AB();}return true;},AI:function(message){var id=message.id;if(!(id in this.C)){this.C[id]=new Array;}this.C[id].length=0;var title=message.title;var items=message.urls;var reffer=message.reffer;var has_items=false;for(var i in items){has_items=true;var item=items[i];var videoItem=new S;videoItem.url=item.url;if(videoItem.url){videoItem.fileName=title+item.ext;videoItem.contentType=item.contentType;videoItem.Z=item.quality;videoItem.reffer=reffer;this.C[id].push(videoItem);}}if(!has_items&&"json"in message){var content=message.json;if(content.is_error){return;}var entry=JSON.parse(content);if(entry.description){title=entry.description;}if(!title&&entry.title){title=entry.title;}var headers="";for(var header in entry.http_headers){headers+=header+": ";headers+=entry.http_headers[header]+"\r\n";}var fmts=entry.formats;for(var i=0;i<fmts.length;i++){var fmt=fmts[i];var fmt_header="";for(var header in fmt.http_headers){fmt_header+=header+": ";fmt_header+=fmt.http_headers[header]+"\r\n";}var videoItem=new S;videoItem.fileName=title+"."+fmt.ext;videoItem.contentType="";videoItem.Z=fmt.format;videoItem.header=fmt_header;if(fmt.file_size){videoItem.contentLength=parseInt(fmt.file_size).toString();}if(fmt.url&&fmt.url.length>0){if(fmt_header==""){fmt_header=headers;}videoItem.header=fmt_header;videoItem.url=fmt.url;}else if(fmt.segs){var segs=[];var segs_size=0;for(var j=0;j<fmt.segs.length;j++){var seg=fmt.segs[j];segs_size+=parseInt(seg.filesize);segs.push(seg.url);}videoItem.segs=segs;videoItem.contentLength=parseInt(segs_size).toString();}if(videoItem.url.length>0||videoItem.segs){this.C[id].push(videoItem);}}}if(this.C[id].length>0&&this.N==id){this.z(this.C[id].length.toString());this.AB();return;}},AY:function(message){if(EG_core.G){EG_core.L(0);EG_core.G=false;}if("ext"in message){EG_core.AK=message.ext;}if("monitor_browser"in message){EG_core.D=message.monitor_browser;}if("whiteList"in message){EG_core.j.length=0;var items=message.whiteList;for(var i in items){var item=new AL;item.url=items[i].url;item.content=items[i].content;EG_core.j.push(item);}}try{if("embed"in message){EG_core.U.length=0;var items=message.embed;for(var i in items){var item=new Aa;item.content=items[i].content;item.combine=items[i].combine;EG_core.U.push(item);}}}catch(exc){}if("id"in message){EG_core.AI(message);return;}EG_core.L(EG_core.D?0:1);EG_core.AB();},AZ:function(){this.AA=false;if(this.I!=null){return;}var nativeHostName="com.eagleget.chrome_extension";this.I=chrome.extension.connectNative(nativeHostName);this.I.onMessage.addListener(this.AY);this.I.onDisconnect.addListener(this.Ai);},AB:function(){var e={name:"exit",paramters:[]};if(this.I){this.I.postMessage(e);this.AA=true;this.I=null;}},AW:function(item){if(item.state=="complete"||item.state=="interrupted"){return;}var id=item.id;var url=item.url;if(EG_core.G||!EG_core.D||!EG_core.V){return;}EG_core.V=false;chrome.downloads.cancel(id);chrome.downloads.erase({id:id},function(ids){});if(EG_core.V){chrome.tabs.query({url:url},function queryResult(tabArray){if(tabArray.length>0){chrome.tabs.remove(tabArray[0].id);}});}},AM:function(request,sender,response){if(EG_core.G){return 0;}if(request.name=="initialize"){EG_core.AE();return;}if(request.name=="capture"){EG_core.AF=request.paramters;return;}if(request.name=="script"){if(!EG_core.D||EG_core.G){return;}var paramters={};paramters.id=sender.tab.id;paramters.content=request.paramters;paramters.title=sender.tab.title;paramters.url=sender.tab.url;var download={name:"script",paramters:paramters};EG_core.Q(download,true,true);return;}if(request.name=="decode_urls"){if(!EG_core.D||EG_core.G){return;}var paramters=request.paramters;paramters.id=sender.tab.id;paramters.title=sender.tab.title;EG_core.AI(paramters);return;}if(request.name=="menuDownload"&&request.url){EG_core.R(request.url,request.cookie,request.referer,"","","","","","");return;}if(request.name=="menuDownloads"&&request.AD){EG_core.R(request.AD,"","","","","","","","");return;}},L:function(status){var imagePath="";var title="";var text="";switch(status){case 0:imagePath="images/icon19_normal.png";title=chrome.i18n.getMessage("enable");break;case 1:imagePath="images/icon19_disabled.png";title=chrome.i18n.getMessage("disable");text="!";break;case 2:imagePath="images/icon19_normal.png";title=chrome.i18n.getMessage("exception");text="!";this.G=true;break;default:;}chrome.browserAction.setIcon({path:imagePath});chrome.browserAction.setTitle({title:title});chrome.browserAction.setBadgeText({text:text});},AP:function(){if(this.Ae("Chrome/")<43){if(navigator.userAgent.indexOf("x64")!=-1||navigator.userAgent.indexOf("Win64")!=-1||navigator.platform=="Win64"){this.plugin=document.getElementById("__EAGLEGET64__");}else{this.plugin=document.getElementById("__EAGLEGET__");}if(this.plugin){try{this.plugin.AO(chrome,true);this.AE();}catch(exc){this.plugin=null;}}if(this.plugin){this.G=false;this.L(0);var preferences={name:"preferences",paramters:[]};this.Q(preferences,true,true);return;}}this.L(2);var preferences={name:"preferences",paramters:[]};this.Q(preferences,true,true);chrome.tabs.onActivated.addListener(function(activeInfo){if(activeInfo.tabId in EG_core.C){EG_core.z(EG_core.C[activeInfo.tabId].length.toString());}else{EG_core.N=0;if(EG_core.G){EG_core.L(2);}else{EG_core.L(EG_core.D?0:1);}}EG_core.N=activeInfo.tabId;});chrome.tabs.onRemoved.addListener(function(tabId,removeInfo){if(tabId in EG_core.C){delete EG_core.C[tabId];}});chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){if(tabId in EG_core.C&&changeInfo.status=="loading"){EG_core.L(EG_core.D?0:1);delete EG_core.C[tabId];}if(changeInfo.status=="complete"&&tab.url){for(var i in EG_core.j){var item=EG_core.j[i];if(tab.url.indexOf(item.url)!=-1){chrome.tabs.sendMessage(tabId,{name:"whitelist",content:item.content});break;}else if(item.content==""&&tab.url.match(item.url)){var paramters={};paramters.id=tabId;paramters.url=tab.url;paramters.title="";paramters.content="";var download={name:"script",paramters:paramters};EG_core.Q(download,true,true);}}if(EG_core.N==0){EG_core.N=tabId;}}if(EG_core.G){EG_core.L(2);}});chrome.extension.onRequest.addListener(this.AM);if(chrome.downloads){chrome.downloads.onCreated.addListener(this.AW);}chrome.webRequest.onHeadersReceived.addListener(this.AR,{urls:["<all_urls>"]},["blocking","responseHeaders"]);chrome.webRequest.onBeforeSendHeaders.addListener(this.Ag,{urls:["<all_urls>"]},["blocking","requestHeaders"]);chrome.webRequest.onBeforeRequest.addListener(this.Ad,{urls:["<all_urls>"]},["blocking","requestBody"]);},AS:function(dispostion){var fileRegex="filename[^;=\n]*=((['\"]).*?\x02|[^;\n]*)";var regex=new RegExp(fileRegex);var AD=regex.exec(dispostion);if(AD==null){return"";}var name=AD[1];name=name.replace(/"([^"]*)"/g,"$1");name=name.replace("UTF-8''","");return decodeURIComponent(name.replace(/\+/g,""));},AV:function(ext){if(ext.length>2&&EG_core.AK.indexOf(ext)!=-1){return true;}return false;},AU:function(ext){for(var i in this.AJ){if(ext==this.AJ[i]){return true;}}return false;},AT:function(fileInfo,tabid){var url=fileInfo.url;for(var i=EG_core.U.length-1;i>=0;i--){var words=EG_core.U[i].content.split("|");for(var j=words.length-1;j>=0;j--){if(url.indexOf(words[j])!=-1&&url.indexOf("el=embedded")){var pos=url.indexOf("video_id=");var end_pos=url.indexOf("&",pos);var video_id;if(pos==-1){return false;}video_id=url.substring(pos,end_pos);var sts;var sts_pos=url.indexOf("sts=");var sts_end_pos=url.indexOf("&",sts_pos);if(sts_pos!=-1){sts=url.substring(sts_pos,sts_end_pos);}if(video_id.length>0&&sts.length>0){var new_url=EG_core.U[i].combine;new_url+=sts;new_url+="&";new_url+=video_id;fileInfo.url=new_url;var req=new XMLHttpRequest;req.open("GET",new_url,true);req.onreadystatechange=function(aEvt){if(req.readyState==4){var paramters={};paramters.id=tabid;paramters.content=req.responseText;paramters.title="";var download={name:"script",paramters:paramters};this.Q(download,true,true);}};req.send();return true;}}}}return false;},AX:function(fileInfo,type,tabId){if(type!="other"&&type!="object"&&type!="xmlhttprequest"&&type!="media"){return 0;}var ext="";if(fileInfo.fileName.length>0){var spotIndex=fileInfo.fileName.lastIndexOf(".");if(spotIndex!=-1){ext=fileInfo.fileName.substr(spotIndex+1);}ext=ext.toLowerCase();}if(ext.length==0&&fileInfo.fileName.length==0){fileInfo.fileName=this.AG(fileInfo.url);var spotIndex=fileInfo.fileName.lastIndexOf(".");if(spotIndex!=-1){ext=fileInfo.fileName.substr(spotIndex+1);}}if(fileInfo.contentType.length==0){return this.AU(ext);}var length=parseInt(fileInfo.contentLength);if(length/1048576<1||ext=="swf"){return-1;}var ct=fileInfo.contentType.toLowerCase();for(var i in EG_core.w){if(ct==EG_core.w[i]||ct.indexOf(EG_core.w[i])!=-1){return 1;}}return 0;},Af:function(fileInfo){var fileName="";if(fileInfo.disposition.length>0){fileName=EG_core.AS(fileInfo.disposition);}if(fileName.length==0){fileName=this.AG(fileInfo.url);}if(fileName==""){return false;}if(fileInfo.contentType.indexOf("text/")!=-1){if(!(fileInfo.contentType.indexOf("text/multipart")!=-1&&fileName.length!=0)){return false;}}var spotIndex=fileName.lastIndexOf(".");var ext=".";if(spotIndex!=-1){ext+=fileName.substr(spotIndex+1);}fileInfo.fileName=fileName;return this.AV(ext);},AG:function(href){var fileName=href.replace(/\?.*$/,"").replace(/.*\//,"");return fileName;},AQ:function(){this.D=!this.D;this.L(this.D?0:1);var setplugin_enable_={name:"monitor_browser",paramters:this.D};this.Q(setplugin_enable_,true,true);},Ah:function(url){for(var i=this.T.length-1;i>=0;i--){var locations=this.T[i];if(url.indexOf(locations.url)!=-1){var paramters={};paramters.url=locations.url;paramters.cookie=locations.cookie;paramters.reffer=locations.reffer;paramters.agent=locations.agent;return paramters;}}return null;},z:function(count){if(!this.D||this.G){return;}var template="Sniffer ";template+=count;template+=" Media";chrome.browserAction.setTitle({title:template});chrome.browserAction.setBadgeText({text:count});},AR:function(details){if(!EG_core.D||EG_core.G||!EG_core.AF||!EG_core.q(details.type)){return{};}var type=details.type;var url=details.url;var fileInfo,location="";var isExist=false;if(url in EG_core.J){fileInfo=EG_core.J[url];delete EG_core.J[url];isExist=true;}else{fileInfo=new S;}var origin=null;for(i=0;i<details.responseHeaders.length;i++){var name=details.responseHeaders[i].name.toLowerCase();var value=details.responseHeaders[i].value;switch(name){case"eagleget":return{responseHeaders:details.responseHeaders};case"location":location=value;if(EG_core.T.length>100){EG_core.T.splice(0,1);}break;case"referer":fileInfo.reffer=value;break;case"set-cookie":if(fileInfo.cookie.length==0){fileInfo.cookie=" "+value;}else{fileInfo.cookie=fileInfo.cookie+"; "+value;}break;case"access-control-allow-origin":if(!origin){origin="Origin: "+value;}break;case"host":fileInfo.host=value;break;case"content-disposition":fileInfo.disposition=value;break;case"content-length":fileInfo.contentLength=value;break;case"content-type":fileInfo.contentType=value;break;default:;}}if(url.length==0){url=host;}if(location.length>0){fileInfo.url=location;EG_core.T.push(fileInfo);fileInfo.url=url;}if(fileInfo.url.length==0){fileInfo.url=url;}var filename="";if(details.frameId>0&&EG_core.AT(fileInfo,details.tabId)){return{};}var result=EG_core.AX(fileInfo,type,details.tabId);if(result==-1){return{};}if(result>0){var id=details.tabId;if(!(id in EG_core.C)){EG_core.C[id]=new Array;}var info=EG_core.C[id];for(var i in info){if(fileInfo.url==info[i].url){return{};}}chrome.tabs.get(details.tabId,function(tab){fileInfo.fileName=tab.title;if(fileInfo.reffer==""){fileInfo.reffer=tab.url;}});if(!fileInfo.header&&origin){fileInfo.header=origin;}info.push(fileInfo);if(EG_core.N==0){EG_core.N=id;}if(EG_core.N==id){EG_core.z(info.length.toString());}return{};}if(EG_core.Af(fileInfo)){fileInfo.header=EG_core.Ah(fileInfo.url);if(!fileInfo.header&&origin){fileInfo.header=origin;}if(Math.round(details.statusCode/100)!=2&&type=="other"){return{};}EG_core.V=true;if(!fileInfo.reffer||fileInfo.reffer.length==0){chrome.tabs.executeScript(details.tabId,{code:"document.referrer;"},function(result){if(!result){result="";}if(Array.isArray(result)&&result.length>0){result=result[0];}fileInfo.reffer=result;if(fileInfo.reffer.length==0){chrome.tabs.executeScript(details.tabId,{code:"document.location.href;"},function(result){if(!result){result="";}if(Array.isArray(result)&&result.length>0){result=result[0];}fileInfo.reffer=result;EG_core.R(fileInfo.url,fileInfo.cookie,fileInfo.reffer,fileInfo.fileName,fileInfo.contentType,fileInfo.disposition,fileInfo.agent,fileInfo.postData,fileInfo.header,fileInfo.contentLength);return{responseHeaders:details.responseHeaders};});return{};}EG_core.R(fileInfo.url,fileInfo.cookie,fileInfo.reffer,fileInfo.fileName,fileInfo.contentType,fileInfo.disposition,fileInfo.agent,fileInfo.postData,fileInfo.header,fileInfo.contentLength);return{responseHeaders:details.responseHeaders};});return{};}EG_core.V=true;EG_core.R(fileInfo.url,fileInfo.cookie,fileInfo.reffer,fileInfo.fileName,fileInfo.contentType,fileInfo.disposition,fileInfo.agent,fileInfo.postData,fileInfo.header,fileInfo.contentLength);return{responseHeaders:details.responseHeaders};}if(isExist){delete EG_core.J[url];}return{};},Ad:function(details){if(!EG_core.D||!EG_core.q(details.type)){return;}var url=details.url;var method=details.method;if(method!="POST"){return;}if(!details.requestBody||!details.requestBody.formData){return;}var requestHeader;var hasExist=false;if(url in EG_core.J){requestHeader=EG_core.J[url];hasExist=true;}else{requestHeader=new S;}var requestBody=details.requestBody;var postData="";for(var key in requestBody.formData){var value=requestBody.formData[key];if(postData.length>0){postData+="&";}postData+=key;postData+="=";if(value){for(var j=0;j<value.length;++j){postData+=value[j];}}if(postData!=""){requestHeader.postData=postData;if(!hasExist){EG_core.J[url]=requestHeader;}}}},Ag:function(details){if(!EG_core.D||!EG_core.q(details.type)){return;}var url=details.url;var method=details.method;var isPostMethod=method=="POST";var requestHeader;var hasExist=false;if(url in EG_core.J){requestHeader=EG_core.J[url];hasExist=true;}else{requestHeader=new S;}for(var i=0;i<details.requestHeaders.length;++i){var name=details.requestHeaders[i].name.toLowerCase();var value=details.requestHeaders[i].value;switch(name){case"user-agent":requestHeader.useragent=value;break;case"referer":requestHeader.reffer=value;break;case"cookie":requestHeader.cookie=value;break;case"content-type":requestHeader.contentType=value;break;default:;}if(isPostMethod&&name=="content-type"){var post_data="Content-Type: ";post_data+=value;post_data+="\r\n";post_data+="Content-Length: ";post_data+=requestHeader.postData.length;post_data+="\r\n\r\n";post_data+=requestHeader.postData;requestHeader.postData=post_data;}if(!hasExist&&(requestHeader.contentType.length!=0||isPostMethod||requestHeader.cookie.length!=0)){EG_core.J[url]=requestHeader;}}},R:function(url,cookie,reffer,fileName,contentType,disposition,agent,postData,header,contentLength,segs){var paramters={};paramters.url=url;paramters.cookie=cookie;paramters.reffer=reffer;if(agent===undefined){agent=window.navigator.userAgent;}if(fileName===undefined){fileName="";}if(contentType===undefined){contentType="";}if(disposition===undefined){disposition="";}if(postData===undefined){postData="";}if(contentLength===undefined){contentLength="";}if(header!==undefined&&header!=""){paramters.header=header;}if(segs!==undefined&&segs){paramters.segs=segs;}paramters.agent=agent;paramters.postData=postData;paramters.contentType=contentType;paramters.disposition=disposition;paramters.fileName=fileName;paramters.contentLength=contentLength;var download={name:"download",paramters:paramters};this.Q(download,true,true);},AN:function(){while(this.W.length>0){chrome.contextMenus.remove(this.W.pop());}},AE:function(){this.AN();var clickedone=function(info,tab){chrome.tabs.sendMessage(tab.id,{name:"ctxclick",loc:info.linkUrl,isall:false});};var clickedall=function(info,tab){chrome.tabs.sendMessage(tab.id,{name:"ctxclick",loc:info.linkUrl,isall:true,selc:info.selectionText});};var title=chrome.i18n.getMessage("menu_download_link");var dat={title:title,contexts:["link"],onclick:function(a,b){clickedone(a,b);}};var finished=function(){if(chrome.extension.lastError){console.log(chrome.extension.lastError.message);}};var id=chrome.contextMenus.create(dat,finished);this.W.push(id);title=chrome.i18n.getMessage("menu_download_all_links");var mutil_all_links={title:title,contexts:["page","selection"],onclick:function(a,b){clickedall(a,b);}};var mid=chrome.contextMenus.create(mutil_all_links,finished);this.W.push(mid);},AC:function(tabs){var details={file:"js/contentscript.js",allFrames:true};for(var i=0;i<tabs.length;i++){try{if(tabs[i].url.indexOf("chrome://")==-1){chrome.tabs.executeScript(tabs[i].id,details);}}catch(exc){}}},Ac:function(){EG=EG_core;chrome.tabs.query({url:"http://*/*"},this.AC);chrome.tabs.query({url:"https://*/*"},this.AC);this.AP();var manifest=chrome.runtime.getManifest();if(chrome.runtime.setUninstallURL){var url="http://www.eagleget.com/eagleget-extension-uninstalled-successfully/?type=chrome&v="+manifest.version;chrome.runtime.setUninstallURL(url);}chrome.runtime.onInstalled.addListener(function(details){if(details.reason=="update"){if(manifest.version!=details.previousVersion){var url="http://www.eagleget.com/eagleget-extension-installed-successfully/?type=chrome&v="+manifest.version;chrome.tabs.create({url:url},function(){});}}});}};EG_core.Ac();})();